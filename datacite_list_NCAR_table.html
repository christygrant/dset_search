<!DOCTYPE html>
<html>
<head>
  <title>Datacite NCAR query</title>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

  <!-- Latest compiled JavaScript -->
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  
  <!-- DataTable plugin for jQuery -->
  <script type="text/javascript" language="javascript" src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.js"></script>
 <!-- <script type="text/javascript" src="https://cdn.datatables.net/1.10.10/js/dataTables.filter.html.js"></script> -->

  <!-- NCAR Theme -->
<!-- <link href="assets/css/fonts.css" rel="stylesheet" />
 <link href="assets/css/custom.css" type="text/css" media="screen" rel="stylesheet"> -->

</head>
<body>

<div class="container"> 

<h1>NCAR Datacite Data Assets</h1>
<h3>Prototype version</h3>
  
   <div class="panel panel-default">Note: This is a prototype version and provides access to a limited subset of data.<br>
   Please <a href='https://jira.ucar.edu/secure/RapidBoard.jspa?rapidView=52&projectKey=DSET&view=planning.nodetail&quickFilter=118'>provide feedback using Jira</a>. 
  </div>
  

<!--
Query: https://search.datacite.org/api?q=*&fq=prefix:10.5065<br>
Query: https://search.datacite.org/api?q=*&fq=prefix:10.5065&wt=json&indent=true&fl=doi,title,description,publicationYear,contributor&rows=3000 <br>
-->	

  <div id="numFound">
	Number of assets found: 
	</div>
 
   <br>
	<table id="example" class="table table-bordered table-hover table-condensed" > 
	 <thead>
            <tr>
                <th>Title</th>
                <th>DOI</th>              
                <th>Description</th>
                <th>Contributor</th>
            </tr>
        </thead>
           
	</table>
  
</div>  
  
<script>

function queryDatacite(numberOfRows) {

  return  $.ajax({
        url: "https://search.datacite.org/api?q=*&fq=prefix:10.5065&wt=json&indent=true&fl=doi,title,description,publicationYear,contributor&rows="+numberOfRows,
        type: "get",
        dataType: "json"
    });
}

function updateDisplayNumberOfRecordsFound (numberOfRecordsFound) {
   $('#numFound').append(numberOfRecordsFound);
}

function updateDisplayRecords (doclist) {

  
    // This sets up the display of the page (template)
     // $('#display').append(doi_link + "<br><div>" + title + "</div><br><div>" + description + "</div><br>");
    
    $('#example').DataTable({
            serverSide: false,
            paging: false,
            searching: true,
          data : doclist,
          columns : [
            { data: "title",
              defaultContent: "<i>Not set</i>",
              width: "20%",
              sortable: true, 
              searchable: true},
            { data: "doi", sortable: true, searchable: true},             
            { data: "description",
              defaultContent: "<i>Not set</i>",
              sortable: true, 
              searchable: true},
            { data: "contributor",
              defaultContent: "<i>Not set</i>"}
          ],
          columnDefs : [
           { type: "string", targets: [0,2,3]},
          {
             targets: 1,
             render: function(data, type, row) {
                return '<a href=http://dx.doi.org/' + data + '>' + data + '</a>';
            }
          }
          
          ]
         
         });       
}   

$(document).ready(function() {


    queryDatacite(0)
    .then(function(data) {

    	var numberOfRecordsFound = data.response.numFound;
      updateDisplayNumberOfRecordsFound(numberOfRecordsFound);        
      
       queryDatacite(numberOfRecordsFound)
       .done (function (data) {
      
          var doclist = data.response.docs;
          //console.log(JSON.stringify(doclist));   
                
          updateDisplayRecords (doclist);
         
        });
      
    });
});
</script>

</body>
</html>
