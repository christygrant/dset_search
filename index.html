<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1">

 <title>Datacite NCAR query</title>
  
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
 
 <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script> 
 <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
            
 <!-- NCAR Theme -->
 <link href="assets/css/fonts.css" rel="stylesheet" />
 <link href="assets/css/custom.css" type="text/css" media="screen" rel="stylesheet">
         
</head>
<body>

 <header id="header-wrap" class="hidden-xs">
    <div class="container">
        <div id="header" class="row">
            <div class="col-md-8 col-sm-8 hidden-xs">
                <div class="" style="float: left">
                        <a href="" title="Home" rel="home" id="ncar-ucar-logo">
                            <img src="assets/images/ncar_ucar_header_logo.png" alt="Home">
                        </a>
                </div>
             <!--   Use this div instead of above to show custom text in header (e.g. app name) vs "National Center for Atmospheric Research" part of logo 
                    from ncar_ucar_header_logo.png -->
             <!--  <div class="hidden-sm" id="app-title-column">
                        <a href="" title="Home" rel="home">
                            <span id="app-title">NCAR Datacite Assets</span>                             
                        </a>
                </div> -->
            </div>
            <div class="col-md-4 col-sm-4 hidden-xs">
                <a href="http://www.nsf.gov/">
                    <img src="assets/images/nsf_header.png" class="img-responsive" id="nsf-header">
                </a>
            </div>
        </div>
    </div>
</header>


<main class="container">

<div id="titleblock" > 
<h1>NCAR Datacite Data Assets</h1>
<h3>Prototype Version</h3>
</div>

<div class="panel panel-warning">
            <div class="panel-heading">
              <h3 class="panel-title">Note: This is a prototype version and provides access to a limited subset of data.</h3>
            </div>
            <div class="panel-body">
              <h5 class="media-heading">Please <a href='https://jira.ucar.edu/secure/RapidBoard.jspa?rapidView=52&projectKey=DSET&view=planning.nodetail&quickFilter=118'>provide feedback using Jira</a>.</h5>
            </div>
          </div>

	<div id="datablock">
	   <div class="well">
	    <small>Loading the results may take a few seconds.</small>
		<h5>Search using Ctrl-F or Cmd-F</h5>
		<br>
		
		<div id="numFound">
		   <strong>Number of records found: </strong>
		</div>
	  </div>	
		
   		<!-- Populated by jQuery loop -->
   		<div id="display">
	 
	  </div> 
	</div> <!--datablock -->	
  
</main>

<footer class="container" id="footer-wrap">
  
    	<div id="orgFooter"><p>© 2016 UCAR | <a href="http://www2.ucar.edu/privacy-policy" target="_blank">Privacy Policy</a> | <a href="http://www2.ucar.edu/terms-of-use" target="_blank">Terms of Use</a> | <a href="https://www2.ucar.edu/notification-copyright-infringement-digital-millennium-copyright-act" target="_blank">Copyright Issues</a> | <a href="http://www.nsf.gov" target="_blank">Sponsored by NSF</a> | <a href="http://www.ucar.edu" target="_blank">Managed by UCAR</a> | <a href="https://ncar.ucar.edu/contact">Webmaster/Feedback</a> 
    	<br>Postal Address: P.O. Box 3000, Boulder, CO 80307-3000 • Shipping Address: 3090 Center Green Drive, Boulder, CO 80301</p>
    	<p>The National Center for Atmospheric Research is sponsored by the National Science Foundation. Any opinions, findings and conclusions or recommendations expressed in this publication are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.</p></div>
</footer>
 
  
<script>

function queryDatacite(numberOfRows) {

	return  $.ajax({
        url: "https://search.datacite.org/api?q=*&fq=prefix:10.5065&wt=json&indent=true&fl=doi,title,description,publicationYear,contributor&rows="+numberOfRows,
        type: "get",
        dataType: "json"
    });
}

function updateDisplayNumberOfRecordsFound (numberOfRecordsFound) {
   $('#numFound').append(numberOfRecordsFound);
}

function updateDisplayRecords (doclist) {

	$.each(doclist, function (i) {
		var title = doclist[i].title;
		var doi = doclist[i].doi;
		var doi_link = '<a href=http://dx.doi.org/' + doi + '>' + doi + '</a>';
		var description = doclist[i].description;
		var contributor = doclist[i].contributor;		   
	   // console.log("doi field: " + doi);
	  
		// This sets up the display of the page (template)
	   // $('#display').append(doi_link + "<br><div>" + title + "</div><br><div>" + description + "</div><br>");
		
		$('#display').append("<div><b>" + title + "</b></div>");
		$('#display').append("<div>" + doi_link + "</div>");
		$('#display').append("<div><h5>Description</h5>" + description + "</div>");
		$('#display').append("<div><h5>Contributors</h5>" + contributor + "</div>");
		$('#display').append("<hr>");
	});    				
}		


$(document).ready(function() {

	queryDatacite(0)
	.then(function(data) {
    
    	var numberOfRecordsFound = data.response.numFound;
        updateDisplayNumberOfRecordsFound(numberOfRecordsFound);        
      
        queryDatacite(numberOfRecordsFound)
        .done (function (data) {
      
            var doclist = data.response.docs;
      	    //console.log(JSON.stringify(doclist));   
             		
	 	    updateDisplayRecords (doclist);
		
        }); 
    }); 
});
</script>

</body>
</html>
